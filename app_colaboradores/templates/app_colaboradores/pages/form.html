{% extends "app_colaboradores/partials/base.html" %}
{% block title %}{{ view.object|default_if_none:"Novo" }} Colaborador{% endblock %}
{% block content %}
<div class="card">
  <div class="card-header">
    <h2>{% if view.object %}Editar{% else %}Novo{% endif %} Colaborador</h2>
  </div>
  <div class="card-body">
    <form method="post" class="row g-3">
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="col-md-6">
        <label class="form-label">Nome</label>
        {{ form.nome }} {{ form.nome.errors }}
      </div>
      <div class="col-md-6">
        <label class="form-label">E-mail</label>
        {{ form.email }} {{ form.email.errors }}
      </div>

      <div class="col-md-6">
        <label class="form-label">Matrícula</label>
        {{ form.matricula }} {{ form.matricula.errors }}
      </div>
      <div class="col-md-6">
        <label class="form-label">Cargo</label>
        {{ form.cargo }} {{ form.cargo.errors }}
      </div>

      <div class="col-md-6">
        <label class="form-label">Setor</label>
        {{ form.setor }} {{ form.setor.errors }}
      </div>
      <div class="col-md-6">
        <label class="form-label">Telefone</label>
        {{ form.telefone }} {{ form.telefone.errors }}
      </div>

      <div class="col-12">
        <div class="form-check">
          {{ form.ativo }} <label class="form-check-label">Ativo?</label>
          {{ form.ativo.errors }}
        </div>
      </div>

      {# Campos de administração (só aparecem se existirem no form) #}
      {% if form.groups %}
        <hr class="mt-3"/>
        <div class="col-12"><h5>Conta e Permissões</h5></div>

        {% if form.criar_usuario and not view.object.user %}
          <div class="col-12">
            <div class="form-check">
              {{ form.criar_usuario }} <label class="form-check-label">Criar usuário de acesso?</label>
              {{ form.criar_usuario.errors }}
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label">Username</label>
            {{ form.username }} {{ form.username.errors }}
          </div>
          <div class="col-md-4">
            <label class="form-label">Senha</label>
            {{ form.password1 }} {{ form.password1.errors }}
          </div>
          <div class="col-md-4">
            <label class="form-label">Confirmar senha</label>
            {{ form.password2 }} {{ form.password2.errors }}
          </div>
        {% endif %}

        <div class="col-12">
          <label class="form-label">Grupos</label>
          {{ form.groups }} {{ form.groups.errors }}
          <div class="form-text">Escolha os grupos/perfis deste colaborador.</div>
        </div>
      {% endif %}

      <div class="col-12 d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{% url 'app_colaboradores:lista' %}">Cancelar</a>
        <button class="btn btn-primary" type="submit">Salvar</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
