{% extends "app_core/partials/base.html" %}
{% block title %}Entrar{% endblock %}

{% block extra_css %}
<style>
  .auth-card{max-width:520px;margin:1.25rem auto;}
</style>
{% endblock %}

{% block content %}
<div class="auth-card">
  <div class="card shadow-sm">
    <div class="card-header">
      <h5 class="mb-0"><i class="bi bi-box-arrow-in-right me-2"></i>Entrar</h5>
    </div>

    <div class="card-body">
      <form method="post" novalidate>
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="mb-3">
          <label for="{{ form.username.id_for_label }}" class="form-label">Usuário</label>
          {{ form.username }}  {# sem as_widget(attrs=...) #}
          {% if form.username.errors %}
            <div class="invalid-feedback d-block">{{ form.username.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="mb-3">
          <label for="{{ form.password.id_for_label }}" class="form-label">Senha</label>
          <div class="input-group">
            {{ form.password }}  {# sem as_widget(attrs=...) #}
            <button class="btn btn-outline-secondary" type="button" id="togglePwd" aria-label="Mostrar/ocultar senha">
              <i class="bi bi-eye"></i>
            </button>
          </div>
          {% if form.password.errors %}
            <div class="invalid-feedback d-block">{{ form.password.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="d-flex gap-2">
          <button class="btn btn-primary" type="submit">Entrar</button>
          <a class="btn btn-outline-secondary" href="{% url 'app_colaboradores:registrar' %}">Criar conta</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Aplica classes/placeholder do Bootstrap nos campos do AuthenticationForm
  (function () {
    const u = document.getElementById('id_username');
    const p = document.getElementById('id_password');
    if (u && !u.classList.contains('form-control')) { u.classList.add('form-control'); }
    if (p && !p.classList.contains('form-control')) { p.classList.add('form-control'); }
    if (u && !u.placeholder) u.placeholder = 'Seu usuário';
    if (p && !p.placeholder) p.placeholder = '••••••••';

    const btn = document.getElementById('togglePwd');
    if (btn && p) {
      btn.addEventListener('click', () => {
        const vis = p.type === 'text';
        p.type = vis ? 'password' : 'text';
        const icon = btn.querySelector('i');
        icon.classList.toggle('bi-eye', vis);
        icon.classList.toggle('bi-eye-slash', !vis);
      });
    }
  })();
</script>
{% endblock %}
