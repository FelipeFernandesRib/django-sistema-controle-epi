{% extends "app_core/base.html" %}
{% load static %}

{% block title %}Início{% endblock %}
{% block page_title %}Dashboard{% endblock %}
{% block breadcrumb %}Início{% endblock %}

{% block content %}
<div class="row g-2">

  {# Colaboradores #}
  {% if perms.app_colaboradores.view_colaborador %}
  <div class="col-12 col-md-6 col-xl-3">
    <div class="card h-100 shadow-sm">
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start justify-content-between">
          <div class="d-inline-flex align-items-center justify-content-center rounded-3 p-3 bg-primary-subtle text-primary">
            <i class="bi bi-people fs-3"></i>
          </div>
          <span class="badge text-bg-light border">
            {{ total_colaboradores|default:"—" }}
          </span>
        </div>
        <h5 class="mt-3 mb-1">Colaboradores</h5>
        <p class="text-muted small mb-3">Cadastro e listagem de colaboradores.</p>

        <div class="mt-auto d-flex gap-2">
          <a class="btn btn-sm btn-outline-primary" href="{% url 'app_colaboradores:lista' %}">
            Abrir lista
          </a>
          {% if perms.app_colaboradores.add_colaborador %}
            <a class="btn btn-sm btn-primary" href="{% url 'app_colaboradores:criar' %}">
              Novo perfil
            </a>
          {% endif %}
        </div>

        <a class="stretched-link" href="{% url 'app_colaboradores:lista' %}" aria-label="Ir para colaboradores"></a>
      </div>
    </div>
  </div>
  {% endif %}

  {# EPIs #}
  <div class="col-12 col-md-6 col-xl-3">
    <div class="card h-100 shadow-sm">
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start justify-content-between">
          <div class="d-inline-flex align-items-center justify-content-center rounded-3 p-3 bg-success-subtle text-success">
            <i class="bi bi-box-seam fs-3"></i>
          </div>
          <span class="badge text-bg-light border">
            {{ total_epis|default:"—" }}
          </span>
        </div>
        <h5 class="mt-3 mb-1">EPIs</h5>
        <p class="text-muted small mb-3">Catálogo de EPIs com filtros.</p>

        <div class="mt-auto d-flex gap-2">
          <a class="btn btn-sm btn-outline-success" href="{% url 'app_epis:lista' %}">
            Abrir catálogo
          </a>
          {% if perms.app_epis.add_epi %}
            <a class="btn btn-sm btn-success" href="{% url 'app_epis:criar' %}">
              Cadastrar EPI
            </a>
          {% endif %}
        </div>

        <a class="stretched-link" href="{% url 'app_epis:lista' %}" aria-label="Ir para EPIs"></a>
      </div>
    </div>
  </div>

  {# Entregas / Solicitações #}
  <div class="col-12 col-md-6 col-xl-3">
    <div class="card h-100 shadow-sm">
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start justify-content-between">
          <div class="d-inline-flex align-items-center justify-content-center rounded-3 p-3 bg-warning-subtle text-warning">
            <i class="bi bi-truck fs-3"></i>
          </div>
          <span class="badge text-bg-light border" title="Entregas ativas">
            {{ entregas_ativas|default:"—" }}
          </span>
        </div>
        <h5 class="mt-3 mb-1">Entregas</h5>
        <p class="text-muted small mb-3">Histórico, solicitações e atendimento.</p>

        <div class="mt-auto d-flex flex-wrap gap-2">
          <a class="btn btn-sm btn-outline-warning" href="{% url 'app_entregas:lista' %}">
            Listar entregas
          </a>

          {# Fluxos por perfil #}
          {% if perms.app_entregas.add_solicitacao %}
            <a class="btn btn-sm btn-warning" href="{% url 'app_entregas:criar_solicitacao' %}">
              Solicitar EPI
            </a>
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'app_entregas:minhas_solicitacoes' %}">
              Minhas solicitações
              {% if minhas_solicitacoes_abertas %}<span class="badge text-bg-secondary ms-1">{{ minhas_solicitacoes_abertas }}</span>{% endif %}
            </a>
          {% endif %}

          {% if perms.app_entregas.change_solicitacao %}
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'app_entregas:solicitacoes_gerenciar' %}">
              Gerenciar solicitações
              {% if solicitacoes_pendentes %}<span class="badge text-bg-danger ms-1">{{ solicitacoes_pendentes }}</span>{% endif %}
            </a>
          {% endif %}
        </div>

        <a class="stretched-link" href="{% url 'app_entregas:lista' %}" aria-label="Ir para entregas"></a>
      </div>
    </div>
  </div>

  {# Relatórios #}
  <div class="col-12 col-md-6 col-xl-3">
    <div class="card h-100 shadow-sm">
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start justify-content-between">
          <div class="d-inline-flex align-items-center justify-content-center rounded-3 p-3 bg-info-subtle text-info">
            <i class="bi bi-graph-up fs-3"></i>
          </div>
          <span class="badge text-bg-light border">
            {{ total_registros_periodo|default:"—" }}
          </span>
        </div>
        <h5 class="mt-3 mb-1">Relatórios</h5>
        <p class="text-muted small mb-3">Por período, colaborador e EPI.</p>

        <div class="mt-auto">
          <a class="btn btn-sm btn-info text-white" href="{% url 'app_relatorios:index' %}">
            Abrir relatórios
          </a>
        </div>

        <a class="stretched-link" href="{% url 'app_relatorios:index' %}" aria-label="Ir para relatórios"></a>
      </div>
    </div>
  </div>

</div>

{# ====== Linha “Resumo rápido” (opcional) ====== #}
<div class="row g-2 mt-2">
  <div class="col-12 col-lg-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted small">Estoque total</span>
          <i class="bi bi-boxes text-secondary"></i>
        </div>
        <div class="fs-4 mt-1">{{ estoque_total|default:"—" }}</div>
        <div class="text-muted small">Itens cadastrados</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted small">Entregues (ativas)</span>
          <i class="bi bi-arrow-right-circle text-secondary"></i>
        </div>
        <div class="fs-4 mt-1">{{ entregas_ativas|default:"—" }}</div>
        <div class="text-muted small">Aguardando devolução</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted small">Devolvidos no mês</span>
          <i class="bi bi-arrow-return-left text-secondary"></i>
        </div>
        <div class="fs-4 mt-1">{{ devolvidos_mes|default:"—" }}</div>
        <div class="text-muted small">Movimentações</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted small">Solicitações pendentes</span>
          <i class="bi bi-hourglass-split text-secondary"></i>
        </div>
        <div class="fs-4 mt-1">
          {% if perms.app_entregas.change_solicitacao %}
            {{ solicitacoes_pendentes|default:"—" }}
          {% else %}
            {{ minhas_solicitacoes_abertas|default:"—" }}
          {% endif %}
        </div>
        <div class="text-muted small">Aguardando ação</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Habilita tooltips (se você usar data-bs-toggle="tooltip" em algum ponto)
  document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
    new bootstrap.Tooltip(el);
  });
</script>
{% endblock %}